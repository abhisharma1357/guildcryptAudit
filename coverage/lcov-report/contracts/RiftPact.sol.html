<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/RiftPact.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> RiftPact.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">97.67% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>42/43</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">60.71% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>17/28</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>14/14</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">97.44% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>38/39</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">pragma solidity ^0.4.24;
&nbsp;
import "./OathForge.sol";
import "./ERC721.sol";
import "./ERC20.sol";
import "./SafeMath.sol";
&nbsp;
/// @title RiftPact: OathForge Token Fracturizer
/// @author GuildCrypt
contract RiftPact is ERC20 {
&nbsp;
  using SafeMath for uint256;
&nbsp;
  address private _daiAddress; // TODO: Hard code; Left variable for testability
  address private _oathForgeAddress; // TODO: Hard code; Left variable for testability
  uint256 private _minAuctionCompleteWait = 0; // 7 days in seconds
&nbsp;
  uint256 private _oathForgeTokenId;
  uint256 private _auctionAllowedAt;
&nbsp;
  uint256 private _auctionStartedAt;
  uint256 private _auctionCompletedAt;
  uint256 private _minBidDeltaPerunNumerator = 5;
  uint256 private _minBidDeltaPerunDenominator = 1000;
&nbsp;
  uint256 private _minBid = 1;
  uint256 private _topBid;
  address private _topBidder;
  uint256 private _topBidSubmittedAt;
&nbsp;
  /// @param __oathForgeTokenId The id of the token on the OathForge contract
  /// @param __auctionAllowedAt The timestamp at which anyone can start an auction
  /// @param __daiAddress The address of the DAI contract. **TODO: Hard code. Left Variable for testability.**
  /// @param __oathForgeAddress The address of the OathForge contract **TODO: Hard code. Left Variable for testability.**
  function RiftPact(
    uint256 __oathForgeTokenId,
    uint256 __auctionAllowedAt,
    address __daiAddress, // TODO: Hard code; Left variable for testability
    address __oathForgeAddress // TODO: Hard code; Left variable for testability
  ) public {
    _oathForgeTokenId = __oathForgeTokenId;
    _auctionAllowedAt = __auctionAllowedAt;
&nbsp;
    _daiAddress = __daiAddress; // TODO: Hard code; Left variable for testability
    _oathForgeAddress = __oathForgeAddress; // TODO: Hard code; Left variable for testability
&nbsp;
    _mint(msg.sender, 10000);
  }
&nbsp;
  /// @dev Emits when an auction is started
  event AuctionStarted();
&nbsp;
  /// @dev Emits when the auction is completed
  /// @param bid The final bid price of the auction
  /// @param winner The winner of the auction
  event AuctionCompleted(address winner, uint256 bid);
&nbsp;
  /// @dev Emits when there is a bid
  /// @param bid The bid
  /// @param bidder The address of the bidder
  event Bid(address bidder, uint256 bid);
&nbsp;
  /// @dev Emits when there is a payout
  /// @param to The address of the account paying out
  /// @param balance The balance of `to` prior to the paying out
  event Payout(address to, uint256 balance);
&nbsp;
  /// @dev Returns the DAI contract address.
  function daiAddress() external view returns(address) {
    return _daiAddress;
  }
&nbsp;
  /// @dev Returns the OathForge contract address.
  function oathForgeAddress() external view returns(address) {
    return _oathForgeAddress;
  }
&nbsp;
  /// @dev Returns the OathForge token id. **Does not imply RiftPact has ownership over token.**
  function oathForgeTokenId() external view returns(uint256) {
    return _oathForgeTokenId;
  }
&nbsp;
  /// @dev Returns the timestamp at which anyone can start an auction by calling [`startAuction()`](#startAuction())
  function auctionAllowedAt() external view returns(uint256) {
    return _auctionAllowedAt;
  }
&nbsp;
  /// @dev Returns the minimum bid in attoDAI (10^-18 DAI).
  function minBid() external view returns(uint256) {
    return _minBid;
  }
&nbsp;
  /// @dev Returns the timestamp at which an auction was started or 0 if no auction has been started
  function auctionStartedAt() external view returns(uint256) {
    return _auctionStartedAt;
  }
&nbsp;
  /// @dev Returns the timestamp at which an auction was completed or 0 if no auction has been completed
  function auctionCompletedAt() external view returns(uint256) {
    return _auctionCompletedAt;
  }
&nbsp;
  /// @dev Returns the top bid or 0 if no bids have been placed
  function topBid() external view returns(uint256) {
    return _topBid;
  }
&nbsp;
  /// @dev Returns the top bidder or `address(0)` if no bids have been placed
  function topBidder() external view returns(address) {
    return _topBidder;
  }
&nbsp;
  /// @dev Start an auction
  function startAuction() external {
    <span class="missing-if-branch" title="else path not taken" >E</span>require(_auctionStartedAt == 0);
    <span class="missing-if-branch" title="else path not taken" >E</span>require(
      (now &gt;= _auctionAllowedAt)
      || (OathForge(_oathForgeAddress).sunsetInitiatedAt(_oathForgeTokenId) &gt; 0)
    );
    emit AuctionStarted();
    _auctionStartedAt = now;
  }
&nbsp;
  /// @dev Submit a bid. Must have sufficient funds approved in `DAI` contract (bid * totalSupply).
  /// @param bid Bid in attoDAI (10^-18 DAI)
  function submitBid(uint256 bid) external {
    <span class="missing-if-branch" title="else path not taken" >E</span>require(_auctionStartedAt &gt; 0);
    <span class="missing-if-branch" title="else path not taken" >E</span>require(_auctionCompletedAt == 0);
    require (bid &gt;= _minBid);
    emit Bid(msg.sender, bid);
    if (_topBidder != address(0)) {
      <span class="missing-if-branch" title="else path not taken" >E</span>require(ERC20(_daiAddress).transfer(_topBidder, _topBid * totalSupply()));
    }
    <span class="missing-if-branch" title="else path not taken" >E</span>require(ERC20(_daiAddress).transferFrom(msg.sender, address(this), bid * totalSupply()));
&nbsp;
    _topBid = bid;
    _topBidder = msg.sender;
    _topBidSubmittedAt = now;
&nbsp;
    uint256 minBidDeltaNumerator = bid * _minBidDeltaPerunNumerator;
    uint256 minBidRoundUp = 0;
&nbsp;
    <span class="missing-if-branch" title="if path not taken" >I</span>if(minBidDeltaNumerator % _minBidDeltaPerunDenominator &gt; 0) {
<span class="cstat-no" title="statement not covered" >      minBidRoundUp = 1</span>;
    }
&nbsp;
    _minBid =  (
      bid + minBidRoundUp + (
      (
        minBidDeltaNumerator / _minBidDeltaPerunDenominator
      )
     )
    );
  }
&nbsp;
  /// @dev Complete auction
  function completeAuction() external {
    require(_auctionCompletedAt == 0);
    <span class="missing-if-branch" title="else path not taken" >E</span>require(_topBid &gt; 0);
    //require((_topBidSubmittedAt + _minAuctionCompleteWait) &lt; now);
    emit AuctionCompleted(_topBidder, _topBid);
    _auctionCompletedAt = now;
  }
&nbsp;
  /// @dev Payout `dai` after auction completed
  function payout() external {
    uint256 balance = balanceOf(msg.sender);
    <span class="missing-if-branch" title="else path not taken" >E</span>require(balance &gt; 0);
    <span class="missing-if-branch" title="else path not taken" >E</span>require(_auctionCompletedAt &gt; 0);
    emit Payout(msg.sender, balance);
    <span class="missing-if-branch" title="else path not taken" >E</span>require(ERC20(_daiAddress).transfer(msg.sender, balance * _topBid));
    _burn(msg.sender, balance);
  }
&nbsp;
&nbsp;
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Jan 16 2019 00:26:59 GMT+0530 (IST)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
